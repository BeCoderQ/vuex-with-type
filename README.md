## ä½œç”¨
vuex-with-typeæ˜¯ä¸ºäº†è§£å†³vuex4ä»¥ä¸‹ç‰ˆæœ¬åœ¨typescriptç¼–å†™æ—¶æ— æ³•æ­£ç¡®æ¨æ–­å‡ºç±»å‹çš„é—®é¢˜ï¼Œå·²æ”¯æŒåµŒå¥—çš„æ¨¡å—æ¨æ–­ã€‚

### æ•ˆæœ

- State:  ![state.gif](https://i.loli.net/2021/07/18/tRYLqQSeXBAzxJf.gif)

- Commit : ![commit.gif](https://i.loli.net/2021/07/18/pEacgtQ5JvnDhUL.gif)

- Dispatch: ![dispatch.gif](https://i.loli.net/2021/07/18/Nhq4noDHrwETKSe.gif)

## åŸç†
vuex4ä»¥ä¸‹ä¸èƒ½æ­£ç¡®æ¨æ–­å‡ºç±»å‹çš„æœ¬è´¨åŸå› æ˜¯å› ä¸ºvuexå®˜æ–¹çš„å£°æ˜æ–‡ä»¶åœ¨åˆå¹¶Vueæ—¶å°†`$store`çš„ç±»å‹æ¨æ–­å†™ä¸ºäº†`Store<any>`ï¼Œè¿™å¯¼è‡´æˆ‘ä»¬åç»­çš„å£°æ˜åˆå¹¶
éƒ½æ— æ³•æ”¶çª„ç±»å‹ï¼Œå› æ­¤stateçš„ç±»å‹ä¸ºanyï¼Œcommitç­‰ç±»å‹ä¹Ÿæ— æ³•å‡†ç¡®æ¨æ–­ã€‚æˆ‘çš„æ–¹æ³•å¾ˆç®€å•ï¼Œè¯»å–node_modulesä¸­vuexçš„è¿™ä¸ªå£°æ˜æ–‡ä»¶ï¼Œå°†å¤šä½™çš„éƒ¨åˆ†å»æ‰ï¼Œ
ç„¶åè‡ªåŠ¨ç”Ÿæˆå¯ä»¥ç²¾ç¡®æ¨æ–­å‡ºstateä¸commitçš„å£°æ˜æ–‡ä»¶ã€‚

## å®‰è£…

```shell
npm install vuex-with-type -g
```



## ä½¿ç”¨æ–¹æ³•
å…¨å±€ä½¿ç”¨`vwt`å‘½ä»¤ï¼š
- vwt handbook  ğŸ‘‰ **æŸ¥çœ‹æ‰€æœ‰å‘½ä»¤è¯´æ˜**
- ~~vwt config  ğŸ‘‰ **ç”Ÿæˆé…ç½®æ–‡ä»¶ ä»¥é…ç½®æ–‡ä»¶çš„å½¢å¼è¿›è¡Œæºç ç”Ÿæˆ**~~
- vwt init  ğŸ‘‰ **åˆå§‹åŒ–å¹¶ç”Ÿæˆå£°æ˜æ–‡ä»¶ å¦‚æœæœ‰configå‘½ä»¤ç”Ÿæˆçš„æ–‡ä»¶ï¼Œåˆ™ä¼šä¼˜å…ˆä½¿ç”¨å®ƒ**

### ç¤ºä¾‹

- store/index.tsï¼š

```typescript
import Vue from 'vue'
import Vuex, { Commit } from 'vuex'
import { isOwnKey, NonNeverState, GetState, GetMutationKeyParamMap, GetActionKeyParamMap } from "vuex-with-type";

Vue.use(Vuex)

const state = {
  token: "",
  openId: "",
  name: "",
  appId: "1"
}

// å°†vuex storeç‹¬ç«‹å‡ºæ¥
const storeOptions = {
  state,
  mutations: {
    SET_STATE(s: NonNeverState<typeof state>, obj: Partial<NonNeverState<typeof state>>) {
      for (const key in obj) {
        if (isOwnKey(key, obj)) {
          s[key] = obj[key];
        }
      }
    },
    SET_NAME(s: NonNeverState<typeof state>, v: string) {
      s.name = v;
    }
  },
  actions: {
    SET_ASYNC_STATE({ commit }: { commit: Commit }, obj: Partial<NonNeverState<typeof state>>) {
      return new Promise(resolve=> {
        setTimeout(()=> {
          commit("SET_STATE", obj);
          resolve(obj);
        });
      });
    }
  },
  modules: {
    modOne: { ... },
    modTwo: { ... }
  }
};

/** TState TMutation TAction(å¦‚æœæœ‰çš„è¯) å¿…é¡»è¦å¯¼å‡ºï¼Œå½“ç„¶ä½ å¯ä»¥ä¸å«è¿™ä¸ªåå­—ï¼Œä½†å¿…é¡»åœ¨
 *	è‡ªåŠ¨ç”Ÿæˆçš„å£°æ˜æ–‡ä»¶ä¸­å¯¹åº”
 */
export type TState = NonNeverState<GetState<typeof storeOptions>>

/**
 * @description mutationç±»å‹ï¼Œèƒ½å¤Ÿæ¨æ–­å‡ºåµŒå¥—çš„modulesï¼š
 * {
 *    SET_XXX: typeof second param;
 *    module/SET_XX: typeof second param;
 *    module/moduleSon/SET_X: typeof second param
 * }
 */
export type TMutation = GetMutationKeyParamMap<typeof storeOptions>;

export type TAction = GetActionKeyParamMap<typeof storeOptions>;

const store = new Vuex.Store<TState>(storeOptions);

export default store;
```

## effect

vuex-with-type is to solve the problem that vuex4 and lower versions cannot correctly infer the type when writing typescript. For now, I only wrote the type inference of state and mutation for the time being.

## prieiple
The essential reason why the type cannot be correctly inferred under vuex4 is because the official vuex declaration file writes the type inference of `$store` as `Store<any>` when merging Vue, which leads to the merger of our subsequent declarations
Neither can narrow the type, so the type of state is any, and the type of commit cannot be accurately inferred. My method is very simple. Reading this declaration file of vuex in node_modules then delete extra part.Then generate a declaration file that can accurately infer the state and commit automatically.

## install

```shell
npm install vuex-with-type -g
```



## usage
Use the `vwt` command globally:
- vwt handbook ğŸ‘‰  **View all command descriptions**
- ~~vwt config  ğŸ‘‰ **Generate configuration file**~~
- vwt init  ğŸ‘‰ **Initialize and generate a declaration file. If there is a file generated by the config command, it will be used first**

if everything is ok, you can get correct type now.

This is my first time writing an open source library, Sorry for not doing well.